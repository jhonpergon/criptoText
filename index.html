<!DOCTYPE html>
<html lang="pt">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CriptoText</title>
	<style>
	body {
      color: #fff;
      background-color: black;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    h1 {
      color: #00ff00;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      height: auto;
    }

    label {
      margin-top: 10px;
      font-size: 18px;
    }

    input {
      padding: 5px;
      font-size: 14px;
      margin: 5px auto;
      width: 95%;
      max-width: 420px;
    }
    textarea{
      margin: 5px auto;
      font-size: 17px;
      width: 97%;
      max-width: 420px;
    }

    button {
      margin: 10px 3px;
      width: 150px;
      height: 30px;
      background-color: #00ff00;
      color: black;
      font-size: 18px;
      border: none;
      cursor: pointer;
    }
	</style>
</head>
<body bgcolor="black">
  <div class="container">
    <h1>CriptoText</h1>
    <label for="mensagem">Digite a mensagem:</label>
    <input type="text" id="mensagem" placeholder="(criptografada ou não)"/>
    <label for="mensagem">Chave:</label>
    <input type="text" id="paresPrimos" placeholder="(Array com pares de primos)"/>
    <label for="mensagem">Resultado:</label>
    <textarea placeholder="..." id="resultado"></textarea>
  </div>
  <button onclick="criptografar()">Criptografar</button>
  <button onclick="descriptografar()">Descriptografar</button>
</body>
<script type="text/javascript">
// Função para verificar se um número é primo
function isPrime(num) {
  if (num <= 1) return false;
  if (num <= 3) return true;

  if (num % 2 === 0 || num % 3 === 0) return false;

  for (let i = 5; i * i <= num; i += 6) {
    if (num % i === 0 || num % (i + 2) === 0) return false;
  }

  return true;
}

// Função para obter um número primo aleatório dentro de um intervalo
function getPrimeInRange(min, max) {
  let num;
  do {
    num = Math.floor(Math.random() * (max - min + 1)) + min;
  } while (!isPrime(num));
  return num;
}

// Função para criptografar um texto
function criptografarTexto(texto) {
  const caracteres = Array.from(texto);
  const paresPrimos = [];
  const textoCriptografado = [];

  for (let i = 0; i < caracteres.length; i++) {
    const char = caracteres[i];
    const charCode = char.charCodeAt(0);
    const prime1 = getPrimeInRange(2, 1000); // Gere primos aleatórios dentro do intervalo desejado
    const prime2 = getPrimeInRange(1001, 2000);
    const valorCriptografado = charCode * prime1 * prime2;
    paresPrimos.push([prime1, prime2]);
    textoCriptografado.push(valorCriptografado);
  }

  return { textoCriptografado, paresPrimos };
}

// Função para descriptografar um texto usando a chave
function descriptografarTexto(criptografado, paresPrimos) {
  const textoDescriptografado = [];

  for (let i = 0; i < criptografado.length; i++) {
    const [prime1, prime2] = paresPrimos[i];
    const valorDescriptografado = criptografado[i] / (prime1 * prime2);
    const charDescriptografado = String.fromCharCode(valorDescriptografado);
    textoDescriptografado.push(charDescriptografado);
  }

  return textoDescriptografado.join("");
}

	let mensagem = document.getElementById("mensagem");
    let primos = document.getElementById("paresPrimos");
    let resultado = document.getElementById("resultado");

    mensagem.value = ``;
    primos.value = ``;
    resultado.value = ``;

	function criptografar() {
      const { textoCriptografado, paresPrimos } = criptografarTexto(mensagem.value);
      //mensagem.value = `${textoCriptografado.join(", ")}`;
      primos.value = `${JSON.stringify(paresPrimos)}`;
      resultado.value = `${textoCriptografado.join(", ")}`;
    }
    function descriptografar() {
      const mensagemCriptografada = document.getElementById("mensagem").value.split(", ");
      const textoDescriptografado = descriptografarTexto(
        mensagemCriptografada.map(Number),
        JSON.parse(document.getElementById("paresPrimos").value)
      );
      //mensagem.value = ``;
      //primos.value = ``;
      resultado.value = `${textoDescriptografado}`;
    }
</script>
</html>
